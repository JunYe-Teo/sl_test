name: Deploy app

on:
  workflow_run:
    workflows:  [Laravel]
    types: [completed]
    branches: [master]

permissions:
  contents: read

jobs:
  deploy-app:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Deploy the app
        uses: digitalocean/app_action/deploy@v2
        env:
          DO_DB_HOST: ${{ secrets.DO_DB_HOST }}
          DO_DB_PORT: ${{ secrets.DO_DB_PORT }}
          DO_DB_DATABASE: ${{ secrets.DO_DB_DATABASE }}
          DO_DB_USERNAME: ${{ secrets.DO_DB_USERNAME }}
          DO_DB_PASSWORD: ${{ secrets.DO_DB_PASSWORD }}
        with:
          token: ${{ secrets.DO_TOKEN }}
